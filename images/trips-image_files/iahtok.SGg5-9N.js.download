(this.$WP=this.$WP||[]).push(["iahtok",(e,o)=>{var a,r,i,t,l,d,n,s,p,u,c,m,h,I,g,v,_,f,U,T,A,w,F,P,L,b,E,y,N,O,x,S,D,C,R,M,k,Z,$,z,B,W,j,q,V,Y,G,H,K,J,X,Q,ee,eo,ea,er,ei,et,el,ed,en,es,ep,eu,ec,em,eh,eI,eg=[".mp4",".m4v",".mov"],ev=({allowedFileTypes:e,maxFileSize:o,mediaType:a,minImageDimensions:r})=>{var{localize:i}=v(),l=t(e=>"video"===a?`${e.name}: ${i.string("post_video_file_type_error")}`:`${e.name}: ${i.string("post_photo_unsupported_file")}`,[i,a]),d=t(e=>"video"===a?`${e.name}: ${i.string("post_video_size_error")}`:`${e.name}: ${i.string("file_size_too_big_photo_oops_message",{0:i.string("mobile_offline_megabyte_ffffec6c",{0:o/1024/1024})})}`,[i,o,a]);return t(i=>{if(i.size>o)return Promise.reject(new K(d(i)));var t=w(i.name);if(!t||!e.includes(t))return Promise.reject(new J(l(i)));var n=eg.includes(t);return"video"===a||void 0===a&&n?Promise.resolve():new Promise((e,o)=>{var a=new Image;a.onload=()=>{r&&(a.width<r.width||a.height<r.height)?o(new X):e(),URL.revokeObjectURL(a.src)},a.onerror=()=>o(new J(l(i))),a.src=URL.createObjectURL(i)})},[e,o,l,d,a,r])},e_=(e,o)=>{var[a,r]=l(!1),i=T();return N("dragover",e=>{null!=e.dataTransfer&&[...e.dataTransfer.items].some(e=>"file"===e.kind)&&(e.dataTransfer.dropEffect="copy",e.preventDefault(),r(!0))}),N("dragleave",e=>{a&&(e.preventDefault(),r(!1))}),N("drop",t=>{if(a){t.preventDefault(),r(!1);var l=[];null!=t.dataTransfer&&(l=(t.dataTransfer.items?[...t.dataTransfer.items].map(e=>e.getAsFile()):[...t.dataTransfer.files]).filter(Boolean)),l.length>0&&(null!==o&&i({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedDragDrop",description:o.length.toString()}}}),e(l))}}),{dragging:a}},ef={__key:66582613602301,id:"3c8e79082ffdad6e",loc:{},definitions:[]},eU={__key:36757335530949,id:"216e3bed5dc5e3b2",loc:{},definitions:[]};function eT(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}var eA=e=>new Promise((o,a)=>{var r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),o({width:r.width,height:r.height})},r.onerror=a,r.src=URL.createObjectURL(e)}),ew=(e,o,a,r)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:o.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:o.status}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:o.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${a+1} of ${r}`}}}),console.error(`MEDIA_UPLOAD_ERROR: ${JSON.stringify({status:o.status,statusText:o.statusText,response:o.response.toString(),fileIndex:a+1,fileCount:r})}`)},eF=(e,o,a,r,i,t,l,d,n,s,p)=>new Promise((u,c)=>{var m=d=>{var m,I=!1,g=new Date().getTime(),v=()=>{null!==n&&(m&&clearTimeout(m),m=setTimeout(()=>{I=!0,r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${i+1} of ${t} upload has timed out after ${(new Date().getTime()-g)/1e3} seconds`}}}),console.error("MEDIA_UPLOAD_ERROR: Upload has timed out"),_.abort()},n))},_=new XMLHttpRequest;_.onload=()=>{m&&clearTimeout(m),200===_.status?(l||r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${i+1} of ${t}`}}}),u(o)):(p(),l||ew(r,_,i,t),c(Error(`Upload of file ${e.name} failed.`)))},_.onerror=()=>{p(),m&&clearTimeout(m),l||ew(r,_,i,t),c(Error(`Upload of file ${e.name} failed.`))},_.onabort=()=>(m&&clearTimeout(m),I)?h(d):(p(),c(Error(`Upload of file ${e.name} aborted.`))),_.upload.onprogress=e=>{v(),s(e.loaded)},_.open("PUT",a,!0),_.send(e),v()},h=e=>{var o=e-1;o<0?c(new ea):m(o)};h(d)}),eP={INITIALIZATION:19,UPLOAD:3,FINALIZE:19},eL=(e=null,o=1)=>{var a=T(),[r,i]=l(null),[s,p]=l({queue:[],counts:{INITIALIZATION:0,UPLOAD:0,FINALIZE:0}}),u=d(!1);n(()=>(u.current=!0,()=>{u.current=!1}),[]);var[,c]=O(ef),[,m]=O(eU),h=S(D),I=C(D),g=R(D),v=M(D),_=k(D),f=Z(D),U=t(e=>{if(u.current)return e;throw _(),Error("upload aborted")},[_]),A=t((e,o)=>new Promise(o=>{p(a=>({...a,queue:[...a.queue,{uploaderStep:e,resolve:()=>o(!0),uid:x()}]}))}).then(o),[]),w=t(e=>{p(o=>({...o,counts:{...o.counts,[e]:o.counts[e]-1}}))},[]);n(()=>{if(s.queue.length>0){var e={...s.counts},o={...s.counts},a=[],r=[];Object.keys(s.counts).forEach(o=>{var i=s.queue.filter(e=>e.uploaderStep===o);if(s.counts[o]<eP[o]){var t=eP[o]-s.counts[o],l=i.slice(0,t);r.push(...l),a.push(...l.map(e=>e.uid)),e[o]+=l.length}}),r.length>0&&(p(r=>({...r,queue:r.queue.filter(e=>!a.includes(e.uid)),counts:{INITIALIZATION:e.INITIALIZATION-(o.INITIALIZATION-r.counts.INITIALIZATION),UPLOAD:e.UPLOAD-(o.UPLOAD-r.counts.UPLOAD),FINALIZE:e.FINALIZE-(o.FINALIZE-r.counts.FINALIZE)}})),r.forEach(e=>e.resolve()))}},[s]);var F=t(({mediaType:r,file:t,description:l,locationId:d,isForCuration:n,isForUserReview:s,isAllowedNonLoggedInUpload:p,pid:u,pidAttr:_,uploaderProgressData:T},F,P)=>{var L=T?.uploaderStep||"INITIALIZATION",b=T?.mediaId,E=T?.uploadUrl,y={description:l,mediaType:"video"===r?"VIDEO":"PHOTO",mimeType:t.type,mediaProvider:"TRIPADVISOR",mediaUploadProvider:"USER",fileName:t.name,fileSize:t.size,locationIds:null!=d&&d>0?[d]:[],isForCuration:n,isForUserReview:s,isAllowedNonLoggedInUpload:p,pid:u,pidAttr:_},N=e=>(h(e.length),c({request:e})),O=()=>{var e=[y],o="video"!==r;return("video"===r?N(e):eA(t).then(({width:e,height:a})=>(e&&a&&e>0&&a>0&&(o=!1),N([{...y,width:e,height:a}])))).then(U).then(({data:e,error:a})=>{if(a||e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.status!=="OK"||e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.mediaId==null||e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.uploadUrl==null){if(a&&console.error(`MEDIA_UPLOAD_ERROR: ${a.toString()}`),e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.status==="RATE_LIMITED")throw v(),new er;throw g(),console.error(`Upload media error (internal): ${a}`),Error("Upload failed")}var{mediaId:r,uploadUrl:i}=e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0];b=r,E=i,o&&console.error(`Upload media does not have dimensions mediaId/Url: ${b}/${E}`)}).then(e=>(w("INITIALIZATION"),e)).then(S)},x=()=>{if(L="UPLOAD",!b||!E)throw Error("Upload failed, mediaId or uploadUrl not provided");return eF(t,b,E,a,F,P.length,"video"===r,o,e,e=>i(o=>{var a=null==o?[]:[...o];return a[F]=e,a}),f).then(U).then(e=>(w("UPLOAD"),e)).then(e=>C(e))},S=()=>A("UPLOAD",x),D=(e=b)=>{if(L="FINALIZE",e)return m({request:{mediaId:e}}).then(()=>(I(1),{mediaId:e,mediaType:r})).then(e=>(w("FINALIZE"),e));throw Error("Finalization failed, mediaId not provided")},C=e=>A("FINALIZE",()=>D(e));return({INITIALIZATION:()=>A("INITIALIZATION",O),UPLOAD:S,FINALIZE:C})[L]().catch(e=>{throw w(L),new ei({mediaId:b,uploaderStep:L,uploadUrl:E},e)}).finally(()=>{i(null)})},[m,c,h,g,I,f,v,U,A,w,a,o,e]);return[{progress:r},t(e=>e.map(F),[F])]},eb=(e,o)=>e.name===o.name&&e.size===o.size,eE={media:[],error:null},ey=({mediaType:e,withMetadata:o,isForCuration:a,allowedFileTypes:r,maxFileSize:i,maxAllowedFiles:d,locationId:n})=>{var s=T(),{localize:p}=v(),u=ev({allowedFileTypes:r,maxFileSize:i,mediaType:e}),[c,m]=l(eE),h=t(e=>{m(o=>({...o,error:e}))},[]),[I,g]=l(!1),_="video"===e,f=_?el.maxAllowedFiles:et.maxAllowedFiles,U=t(o=>{u(o).then(()=>{m(r=>r.media.some(e=>eb(e.file,o))?r:r.media.length>=d?d!==f?r:{error:_?p.string("video_upload_max_number",{nVideos:d}):p.string("post_photo_tips_guidelines"),media:r.media}:{error:r.error,media:[...r.media,{mediaType:e,file:o,description:"",locationId:n,isForCuration:a}]})}).catch(e=>{_||s({PhotoUploadFlow:{photoUploadWeb:{action:"invalidFile",description:e.message}}}),h(e.message)})},[u,d,a,n,p,h,e,f,_,s]),A=t(e=>{h(null),e.preventDefault(),[...e.target.files??[]].forEach(U),_||s({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedFilePicker",description:c.media.length.toString()}}}),e.currentTarget.value=""},[U,h,s,_,c.media.length]),w=t((e,o)=>{m(a=>{var r=[...a.media];return r[e]=o,{error:null,media:r}})},[]),F=t(e=>{m(o=>{var a=[...o.media];return a.splice(e,1),{error:null,media:a}})},[]),{dragging:P}=e_(e=>{h(null),e.forEach(U)},_?null:c.media),L=!I&&c.media.length>0&&(!o||!_&&a||c.media.every(e=>e.description&&null!=e.locationId&&e.locationId>0)),[{progress:b},E]=eL(),y=t(()=>L?(_||s({PhotoUploadFlow:{photoUploadWeb:{action:"submitClicked"}}}),g(!0),h(null),Promise.all(E(c.media)).then(e=>(_||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedAll"}}}),g(!1),e)).catch(()=>{_||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedErrorExists"}}}),h(_?p.string("video_upload_fail"):p.string("post_photo_upload_failed")),g(!1)})):Promise.reject(),[E,L,c.media,h,p,_,s]);return{media:c.media,error:c.error,uploading:I,progress:b,canAddMore:c.media.length<d,canSubmit:L,dragging:P,onFileSelected:A,onMediaChanged:w,onMediaDeleted:F,onSubmit:y,resetMediaState:()=>m(eE)}},eN={__key:0xac16b35df15,id:"0ac16b35df152d66",loc:{},definitions:[]},eO={__key:0xdc51c969080a,id:"dc51c969080a7a5d",loc:{},definitions:[]},ex=(e,o,a,r)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:o.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:o.status?o.status.toString():""}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:o.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${a+1} of ${r}`}}}),console.error(`MEDIA_UPLOAD_ERROR: ${JSON.stringify({status:o.status,statusText:o.statusText,response:o.response.toString(),fileIndex:a+1,fileCount:r})}`)},eS=(e,o,a,r,i,t,l,d,n,s,p)=>new Promise((u,c)=>{var m=d=>{var m,I=!1,g=()=>{null!==n&&(m&&clearTimeout(m),m=setTimeout(()=>{I=!0,r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${i+1} of ${t} upload has timed out`}}}),console.error("MEDIA_UPLOAD_ERROR: Upload has timed out"),v.abort()},n))},v=new XMLHttpRequest;v.open("PUT",a,!0),v.onload=()=>{m&&clearTimeout(m),200===v.status?(l||r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${i+1} of ${t}`}}}),u(o)):(p(),l||ex(r,v,i,t),c(Error(`Upload of file ${e.name} failed.`)))},v.onerror=()=>{p(),m&&clearTimeout(m),l||ex(r,v,i,t),c(Error(`Upload of file ${e.name} failed.`))},v.onabort=()=>(m&&clearTimeout(m),I)?h(d):(p(),c(Error(`Upload of file ${e.name} aborted.`))),v.upload.onprogress=e=>{g(),s(e.loaded)},v.send(e),g()},h=e=>{var o=e-1;o<0?c(new Q):m(o)};h(d)});function eD(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}var eC=e=>{var o,a="video"===e.mediaType?"VIDEO":"PHOTO",r={albumId:e.categoryId,description:e.description,mimeType:e.file.type,fileName:e.file.name,fileSize:e.file.size,mediaType:a};return"VIDEO"!==a?(o=e.file,new Promise((e,a)=>{var r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),e({width:r.width,height:r.height})},r.onerror=a,r.src=URL.createObjectURL(o)})).then(({width:e,height:o})=>({...r,width:e,height:o})).catch(e=>(console.error(`Error parsing image dimensions: ${e.message}`),new Promise(e=>{e(r)}))):new Promise(e=>{e(r)})},eR={INITIALIZATION:100,UPLOAD:3,FINALIZE:19},eM=(e=null,o=1)=>{var a=T(),[r,i]=l(null),[s,p]=l({queue:[],counts:{INITIALIZATION:0,UPLOAD:0,FINALIZE:0}}),u=d(!1);n(()=>(u.current=!0,()=>{u.current=!1}),[]);var[,c]=O(eN),[,m]=O(eO),h=S(D),I=C(D),g=R(D),v=M(D),_=k(D),f=Z(D),U=t(e=>{if(u.current)return e;throw _(),Error("upload aborted")},[_]),A=t((e,o)=>new Promise(o=>{p(a=>({...a,queue:[...a.queue,{uploaderStep:e,resolve:()=>o(!0),uid:x()}]}))}).then(o),[]),w=t(e=>{p(o=>({...o,counts:{...o.counts,[e]:o.counts[e]-1}}))},[]);n(()=>{if(s.queue.length>0){var e={...s.counts},o={...s.counts},a=[],r=[];Object.keys(s.counts).forEach(o=>{if(s.counts[o]<eR[o]){var i=s.queue.filter(e=>e.uploaderStep===o),t=eR[o]-s.counts[o],l=i.slice(0,t);r.push(...l),a.push(...l.map(e=>e.uid)),e[o]+=l.length}}),r.length>0&&(p(r=>({...r,queue:r.queue.filter(e=>!a.includes(e.uid)),counts:{INITIALIZATION:e.INITIALIZATION-(o.INITIALIZATION-r.counts.INITIALIZATION),UPLOAD:e.UPLOAD-(o.UPLOAD-r.counts.UPLOAD),FINALIZE:e.FINALIZE-(o.FINALIZE-r.counts.FINALIZE)}})),r.forEach(e=>e.resolve()))}},[s]);var F=t(e=>{var o=e=>(h(e.length),c({request:e})),a=e.filter(e=>!e.uploaderProgressData?.mediaId||!e.uploaderProgressData?.uploadUrl).map(e=>eC(e));if(0===a.length)return new Promise(o=>{o(e.filter(Boolean))});var{locationId:r,isForCuration:i,isForUserReview:t,isAllowedNonLoggedInUpload:l,pid:d,pidAttr:n}=e[0];return Promise.all(a).then(e=>o([{mediaToUpload:e,mediaProvider:"TRIPADVISOR",mediaUploadProvider:"USER",locationIds:null!=r&&r>0?[r]:[],isForCuration:i,isForUserReview:t,isAllowedNonLoggedInUpload:l,pid:d,pidAttr:n}])).then(U).then(({data:o,error:a})=>{a&&console.error(`MEDIA_UPLOAD_ERROR: ${a.toString()}`);var r=o?.MediaSvcClient_initiateMediaArrayBatchUpload?.[0]?.media?.filter(e=>!!(e?.status==="OK"&&e?.mediaId&&e?.uploadUrl)||(e?.status==="RATE_LIMITED"?v():g(),!1));if(!r?.length)throw Error("Upload failed, failed to call initialization");return e.map((e,a)=>{var r=o?.MediaSvcClient_initiateMediaArrayBatchUpload?.[0]?.media?.[a]?.mediaId||0,i=o?.MediaSvcClient_initiateMediaArrayBatchUpload?.[0]?.media?.[a]?.uploadUrl||"",t={...e.uploaderProgressData,uploaderStep:"INITIALIZATION",mediaId:r,uploadUrl:i};return{...e,uploaderProgressData:t}})})},[U,c,h,g,v]),P=t((r,t,l)=>{var d=r?.uploaderProgressData,n=d?.uploaderStep||"INITIALIZATION",{mediaType:s}=r,p=d?.mediaId,u=d?.uploadUrl,c=()=>new Promise((e,o)=>{d?.mediaId!==0&&d?.uploadUrl!==""&&e(r),o(Error("Initialization failed."))}).then(e=>(w("INITIALIZATION"),e)).then(g),h=()=>{if(n="UPLOAD",!d||!d.mediaId||!d.uploadUrl)throw Error("Upload failed, mediaId or uploadUrl not provided");return eS(r.file,d.mediaId,d.uploadUrl,a,t,l.length,"video"===r.mediaType,o,e,e=>i(o=>{var a=null==o?[]:[...o];return a[t]=e,a}),f).then(U).then(e=>(w("UPLOAD"),e)).then(e=>_(e))},g=()=>A("UPLOAD",h),v=(e=p)=>{if(n="FINALIZE",e)return m({request:[{mediaIds:[e]}]}).then(()=>(I(1),{mediaId:e,mediaType:s})).then(e=>(w("FINALIZE"),e));throw Error("Finalization failed, mediaId not provided")},_=e=>A("FINALIZE",()=>v(e));return({INITIALIZATION:()=>A("INITIALIZATION",c),UPLOAD:g,FINALIZE:_})[n]().catch(e=>{throw w(n),new eo({mediaId:p,uploaderStep:n,uploadUrl:u},e)}).finally(()=>{i(null)})},[m,I,f,U,A,w,a,o,e]);return[{progress:r},t(e=>F(e).then(e=>e.map(P)),[P,F])]},ek=({children:e,timeout:o,retryCount:i,mediaType:u,onRateLimitedError:c,beforePhotoUploadCheck:m,handleErrorsManually:h,minImageDimensions:I,...v})=>{var[U,T]=s(_),A=d(null),F={...en,..."photo"===u&&et,..."video"===u&&el,...v},[P,b]=l([]),[y,N]=l([]),[{progress:O},S]=eL(o,i),[{progress:D},C]=eM(o,i),R=ev({allowedFileTypes:F.allowedFileTypes,maxFileSize:F.maxFileSize,minImageDimensions:I}),M=F.batchedUpload?D:O,k=d([]),Z=t(e=>{k.current.splice(0,0,e)},[]),$=t(e=>{var o=k.current.findIndex(o=>e===o);k.current.splice(o,1)},[]),z=t(()=>{var e=A.current;if(null==e)throw Error("useCustomPhotoUploadFlow: must render the supplied element");e.click()},[]),B=t(e=>{b(e),C(e).then(o=>o.forEach((o,a)=>{o.then(o=>{N(r=>r.map(r=>r.uploadId===e[a].uploadId?{...r,result:o}:r))}).catch(o=>{var r=o?.uploaderProgressData,i=o?.originalError||o;N(o=>o.map(o=>o.uploadId===e[a].uploadId?{...o,result:{definition:{...e[a],uploadId:o.uploadId,uploaderProgressData:r},error:i}}:o))})})).catch(o=>{N(a=>a.map(a=>{var r=e.find(e=>e.uploadId===a.uploadId);if(!r)return a;var i={definition:{...r,mediaType:r.mediaType,uploaderProgressData:void 0,uploadId:a.uploadId},error:o};return{...a,result:i}}))})},[C]),W=t(e=>{b(e),S(e).forEach((o,a)=>{o.then(o=>{N(r=>r.map(r=>r.uploadId===e[a].uploadId?{...r,result:o}:r))}).catch(o=>{var r=o?.uploaderProgressData,i=o?.originalError||o;N(o=>o.map(o=>o.uploadId===e[a].uploadId?{...o,result:{definition:{...e[a],uploadId:o.uploadId,uploaderProgressData:r},error:i}}:o))})})},[S]),j=F.batchedUpload?B:W,q=t(e=>{var o=e.map(e=>({...e,uploadId:e.uploadId||x()})),a=o.filter(e=>!e?.error);m&&!1===m(a)||(N(e=>[...e,...o.map(e=>({uploadId:e.uploadId,result:e?.error?{fileName:e?.fileName,error:e?.error}:null}))]),j(a))},[j,m]),V=t(e=>{var o=e.map(e=>({...e,uploadId:e.uploadId||x()}));m&&!1===m(o)||(N(e=>[...e,...o.map(e=>({uploadId:e.uploadId,result:null}))]),j(o))},[j,m]);n(()=>{if(y.length>0&&y.every(e=>!!e.result)){var e=y.filter(e=>e.result?.mediaId).map(e=>e.result),o=y.filter(e=>e.result?.error).map(e=>e.result).map(e=>e.error);!h&&o[0]&&(o[0]instanceof ea||o[0]instanceof Q?U({node:a(f,{cta:a(E,{trailing:!0,variant:"on-dark",onClick:()=>{V(P),T()},icon:L,children:"Click to retry"}),children:"Upload failed."}),timeout:1e4}):(o[0]instanceof er||o[0]instanceof ee)&&c?c(z):U({node:a(f,{children:o[0].message||a(g,{id:"post_photo_upload_failed"})})})),h&&o.find(e=>e instanceof er||e instanceof ee)&&c&&c(z),(h||!o[0])&&k.current.find(o=>!1!==o(e,y)),b([]),N([])}},[y,P.length,h,T,U,c,z,P,V]);var Y=t(e=>{Promise.allSettled(e.map(e=>R(e))).then(o=>{var a=e.map((e,a)=>"fulfilled"===o[a].status?{mediaType:el.allowedFileTypes.includes(w(e.name))?"video":"photo",file:e,locationId:-1===F.locationId?null:F.locationId,description:"",isForCuration:F.isForCuration,isForUserReview:F.isForUserReview,isAllowedNonLoggedInUpload:F.isAllowedNonLoggedInUpload,pid:F.pid,pidAttr:F.pidAttr,uploadId:x()}:{fileName:e.name,error:o[a].reason,uploadId:x()}).filter(e=>!(e?.error instanceof X)),r=a.find(e=>!!e?.error);if(r&&!h)throw r.error;(!r||h)&&q(a)})},[R,q,F.isForCuration,F.isForUserReview,F.isAllowedNonLoggedInUpload,F.locationId,F.pid,F.pidAttr,h]),{dragging:G}=e_(Y,P),H=p(()=>({photos:P,photosResultQueue:y,open:z,dragging:G,progress:M,selectFiles:Y,uploadFiles:V,addPhotosUploadedCallback:Z,removePhotosUploadedCallback:$}),[P,y,z,G,M,Z,Y,$,V]);return r(ed.Provider,{value:H,children:[e,a("input",{ref:A,type:"file",multiple:!F?.maxAllowedFiles||F.maxAllowedFiles>1,accept:F.allowedFileTypes.join(","),style:{display:"none"},onChange:e=>{e.preventDefault(),Y(e.currentTarget.files?[...e.currentTarget.files].filter(Boolean):[]),e.currentTarget.value=""},"aria-hidden":!0,tabIndex:-1})]})},eZ=e=>{var{addPhotosUploadedCallback:o,removePhotosUploadedCallback:a,...r}=s(ed),i=d(e);return i.current=e,n(()=>{if(null==i.current)return()=>{};var e=(e,o)=>!!i.current&&i.current(e,o);return o(e),()=>{a(e)}},[o,a]),r},e$=(e,o,a=e=>e)=>{var t=e.match(o);return t?.index!=null?r(i,{children:[e.substring(0,t.index),a(t[1]||t[0]),e.substring(t.index+t[0].length)]}):e},ez={dropZone:"wWxsJ e u j c z _E B2 BC",small:"GLyFA",large:"OlQdl",fileInput:"bAYEn Xd",disabled:"AxRyl",dragging:"kQZzc",cosmeticButton:"ViJpi Rd _S",cosmeticBorderlessButton:"GOYkZ Wd _S",keyboardMode:"kIOnU",touchOnly:"tMKCA",mouseOnly:"lVrpX"},eB=({plural:e})=>e?a(g,{id:"post_photo_upload_photos_button"}):a(g,{id:"confirmed_booker_upload_photo"}),eW=({variant:e="large",dragging:o,disabled:i,allowedFileTypes:t=[],onFileSelected:l,mediaType:d,multiple:n=!1,...s})=>{var p=B(),{localize:u}=v();return r("label",{className:W(ez.dropZone,j(s),{[ez.small]:"small"===e,[ez.large]:"large"===e,[ez.dragging]:!i&&o,[ez.disabled]:i,[ez.keyboardMode]:p}),children:[a("input",{type:"file",multiple:n,accept:t.join(","),disabled:i,className:ez.fileInput,onChange:l,tabIndex:i?-1:0}),"small"===e&&r(z,{variant:"supporting-01",children:[a("span",{className:ez.mouseOnly,children:es("video"===d?u.string("post_video_upload_another_video"):u.string("post_photo_upload_another_video"),/<\/> <span class="{sColorClass1}">(.*)<\/span>/,e=>a("span",{className:ez.cosmeticBorderlessButton,children:e}))}),a("span",{className:W(ez.touchOnly,ez.cosmeticBorderlessButton),children:"video"===d?a(g,{id:"add_more_videos_mw_uploader"}):a(g,{id:"add_more_photos_mw_uploader"})})]}),"large"===e&&r("div",{children:[a(z,{variant:"button-01",marginY:"spacing-03",children:a("div",{className:ez.cosmeticButton,children:"video"===d?a(g,{id:"add_more_videos_mw_uploader"}):a(ep,{plural:n})})}),r("div",{className:ez.mouseOnly,"aria-hidden":!0,children:[a(z,{variant:"supporting-01",marginY:"spacing-03",children:a(g,{id:"post_photo_or_just_text"})}),a(z,{variant:"title-05",marginY:"spacing-03",children:a(g,{id:"post_photo_drag_and_drop_from_desktop"})})]})]})]})},ej=({multipleMedia:e,mediaType:o,...r})=>{var i,{localize:t}=v();return i=e?"video"===o?t.string("new_videos_terms_of_use"):t.string("new_photos_terms_of_use"):"video"===o?t.string("new_video_terms_of_use"):t.string("new_photo_terms_of_use"),a("div",{className:W("yNxWj",j(r)),children:a(z,{variant:"supporting-01",elementType:"span",children:es(i,/<a .*>(.*)<\/a>/,e=>a(q,{theme:"inline",href:"/pages/terms.html",target:"_blank",children:e}))})})},eq=({mediaType:e,maxAllowedFiles:o,allowedFileTypes:i,maxFileSize:t,...l})=>{var{localize:d}=v(),n=T(),s="video"===e,p=`${d.string("mobile_help_center_url")}${s?"/articles/360024933773-Video-Guidelines":"/articles/200615067"}`,u=o>1?a(g,{id:"post_photo_tips_guidelines"}):null;return r("div",{className:j(l),children:[a(z,{variant:"title-05",marginBottom:"spacing-02",children:a(g,{id:"flash_uploader_tips_and_guidelines_10d8"})}),r("ul",{children:[a("li",{children:a(z,{variant:"supporting-02",marginY:"spacing-01",children:s?a(g,{id:"video_upload_max_number",args:{nVideos:o}}):u})}),a("li",{children:a(z,{variant:"supporting-02",marginY:"spacing-01",children:s?a(g,{id:"video_upload_video_formats_accepted",args:{sFileExtentions:i.join(" ")}}):a(g,{id:"post_photo_accepted_formats"})})}),a("li",{children:a(z,{variant:"supporting-02",marginY:"spacing-01",children:a(g,{id:"file_size_limit_photo",args:{0:t/1024/1024}})})})]}),a(z,{variant:"supporting-02",marginTop:"spacing-03",marginBottom:"spacing-05",children:es(s?d.string("video_upload_more_info_guidelines_link"):d.string("post_photo_more_info_2"),/<span>(.*)<\/span>/,e=>a(q,{theme:"inline",href:p,onClick:()=>{s||n({PhotoUploadFlow:{photoUploadWeb:{action:"guidelinesClick"}}})},target:"_blank",children:e}))})]})},eV={mediaUploadItem:"Cmrpl",withMetadata:"KZHqm",preview:"NxRph",mediaWrapper:"hakMy",media:"ONDNs _R Gp w",deleteButton:"RAxBx",progress:"WBEFN",metadata:"wvYam",locationSelector:"FrvbG"},eY=({media:e,index:o,mediaCount:i,withMetadata:d=!0,isForCuration:s=!1,hasPresetLocation:u=!1,progress:c,onChange:m,onDelete:h})=>{var{localize:I}=v(),[_,f]=l(!1),[U,T]=l(!1),A=p(()=>URL.createObjectURL(e.file),[e.file]);n(()=>()=>URL.revokeObjectURL(A),[A]);var[w,F]=l(null),P=t(()=>h&&h(o),[h,o]),L=t(a=>{f(!1),m(o,{...e,description:a.currentTarget.value})},[o,e,m]),b=t(a=>{F(a),T(!0),m(o,{...e,locationId:a?.locationId})},[o,e,m]),E=t(()=>{F(null),T(!1),m(o,{...e,locationId:null})},[o,e,m]),N=_&&!e.description?a(g,{id:"uploader_error_required_field"}):null,O=U&&(null==e.locationId||e.locationId<=0)?a(g,{id:"uploader_error_required_field"}):null,x=null!=c,S="video"===e.mediaType?a(g,{id:"post_video_video_count_text",args:{nCurrentVideoCount:o+1,nTotalVideoCount:i}}):a(g,{id:"post_photo_video_count_text",args:{nCurrentphotoCount:o+1,nTotalphotoCount:i}});return r("div",{className:W(eV.mediaUploadItem,{[eV.withMetadata]:d}),children:[r("div",{className:eV.preview,children:[i>1&&a(z,{variant:"title-05",marginBottom:"spacing-02",children:S}),r("div",{className:eV.mediaWrapper,children:["photo"===e.mediaType&&a("img",{className:eV.media,src:A,alt:""}),"video"===e.mediaType&&r("video",{controls:!0,controlsList:"nodownload nofullscreen",className:eV.media,children:[a("track",{default:!0,kind:"captions"}),a("source",{src:A,type:"video/mp4"})]}),!x&&a("div",{className:eV.deleteButton,children:a(y,{size:"small",variant:"dark",icon:Y,"aria-label":I.string("mobile_delete"),onClick:P})}),null!=c&&a("div",{className:eV.progress,children:a(G,{numSteps:e.file.size,currentStep:c})})]})]}),d&&r("div",{className:eV.metadata,children:[a(H,{id:`media-upload-description-${o}`,variant:"five-line",label:a(z,{variant:"title-05",children:a(g,{id:"post_photo_add_description_v2_part_1"})}),placeholder:"video"===e.mediaType?I.string("post_video_add_description_v2_part_2"):I.string("post_photo_add_description_v2_part_2"),maxLength:500,characterCountType:N?void 0:"max",required:!0,value:e.description,state:x?"disabled":N?"error":"enabled",errorText:N,onChange:L,onBlur:()=>f(!0),marginBottom:"spacing-03"}),!s&&!u&&a("div",{className:eV.locationSelector,children:null==w?a(V,{size:"small",errorText:O,placeholder:I.string("photo_uploader_add_a_location_tag"),onTextInputChanged:()=>T(!1),onBlur:()=>T(!0),onSelect:b}):a(y,{size:"small",variant:"dark",icon:Y,textPosition:"lead","aria-label":`${w.searchText}. ${I.string("remove_location_cf6")}`,disabled:x,onClick:E,children:w.title})})]})]})},eG=({locationId:e=-1,tracking:o})=>{var[l]=s(_),d=$(),p={...et,locationId:e},{media:u,error:m,dragging:h,uploading:I,progress:v,canAddMore:U,canSubmit:T,onFileSelected:A,onMediaChanged:w,onMediaDeleted:F,onSubmit:P,resetMediaState:L}=ey(p),E=u.length>0,y=u.length>1;n(()=>{-1===e&&L()},[L,e]);var N=t(()=>{o?.onSubmit(u.length),d({}).then(()=>{P().then(e=>{null!=e&&(o?.onSuccess(u.length),L(),l({node:a(f,{children:a(g,{id:"success_repost_photo"})})}))})})},[P,l,L,d,o,u.length]),O=y?a(g,{id:"ugc_uploader_photo_v3"}):a(g,{id:"ugc_uploader_photo_v2"});return r(i,{children:[U&&a(eu,{variant:E?"small":"large",dragging:h,disabled:I||-1===e,onFileSelected:A,marginBottom:"spacing-05",mediaType:p.mediaType,multiple:!0}),null!=m&&a(z,{variant:"supporting-01",color:"dangerText",marginY:"spacing-05",children:m}),u.map((e,o)=>a(c,{children:a(eh,{media:e,index:o,mediaCount:u.length,withMetadata:p.withMetadata,isForCuration:p.isForCuration,hasPresetLocation:null!=p.locationId&&p.locationId>0,progress:I&&null!=v?v[o]:void 0,onChange:w,onDelete:F})},`${e.file.name}/${e.file.size}`)),E?r(i,{children:[a(ec,{multipleMedia:y,mediaType:p.mediaType,marginTop:"spacing-05",marginBottom:"spacing-03"}),a(b,{variant:"primary",size:"medium",disabled:!T,onClick:N,children:O})]}):a(em,{mediaType:p.mediaType,maxAllowedFiles:p.maxAllowedFiles,allowedFileTypes:p.allowedFileTypes,maxFileSize:p.maxFileSize,marginTop:"spacing-05"})]})},eH=({onUploadSuccess:e,onUploadCanceled:o,...l})=>{var d={...el,...l},{media:n,error:s,dragging:p,uploading:u,progress:m,canAddMore:h,canSubmit:I,onFileSelected:v,onMediaChanged:_,onMediaDeleted:f,onSubmit:U}=ey(d),T=n.length>0,A=n.length>1,w=t(()=>{U().then(o=>{null!=e&&null!=o&&e(o)})},[U,e]);return r(i,{children:[h&&a(eu,{variant:"large",dragging:p,disabled:u,onFileSelected:v,marginBottom:"spacing-05",mediaType:d.mediaType}),null!=s&&a(z,{variant:"supporting-01",color:"dangerText",marginY:"spacing-05",children:s}),n.map((e,o)=>a(c,{children:a(eh,{media:e,index:o,mediaCount:n.length,withMetadata:d.withMetadata,isForCuration:d.isForCuration,hasPresetLocation:null!=d.locationId&&d.locationId>0,progress:u&&null!=m?m[o]:void 0,onChange:_,onDelete:f})},`${e.file.name}/${e.file.size}`)),T?r(i,{children:[a(ec,{multipleMedia:A,mediaType:d.mediaType,marginTop:"spacing-05",marginBottom:"spacing-03"}),a(b,{variant:"primary",size:"medium",disabled:!I,onClick:w,children:a(g,{id:"b2b_media_upload_text"})})]}):a(em,{mediaType:d.mediaType,maxAllowedFiles:d.maxAllowedFiles,allowedFileTypes:d.allowedFileTypes,maxFileSize:d.maxFileSize,marginTop:"spacing-05"}),a(b,{variant:"primary",size:"medium",onClick:o,marginLeft:T?"spacing-01":void 0,children:a(g,{id:"mc_plus_cancel"})})]})},eK=(e=Object.freeze({}))=>{var o=T(),{login:r}=U(),[i]=s(_),l=d(()=>{}),{open:n}=I(({close:o})=>a(A,{children:a(m,{children:a(eI,{...e,onUploadCanceled:()=>{o(),l.current([])},onUploadSuccess:(...r)=>{o(),i({node:a(f,{children:"video"===e.mediaType?a(g,{id:"success_repost_video"}):a(g,{id:"success_repost_photo"})})}),l.current(...r)}})})}),{},[e,i]);return t(()=>r({flow:"CORE_COMBINED"}).then(()=>(n(),"video"!==e.mediaType&&o({PhotoUploadFlow:{photoUploadWeb:{action:"opened"}}}),new Promise(e=>{l.current=e}))),[r,n,o,e.mediaType])};return[()=>{e("FileSizeError",K=class extends Error{}),e("FileTypeError",J=class extends Error{}),X=class extends Error{},ea=class extends Error{},er=class extends Error{},ei=class extends Error{constructor(e,o){super(),eT(this,"uploaderProgressData",void 0),eT(this,"originalError",void 0),this.uploaderProgressData=e,this.originalError=o}},et={mediaType:"photo",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".jpg",".jpeg",".gif",".png"],maxFileSize:F,maxAllowedFiles:10,locationId:-1},el={mediaType:"video",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".mp4",".m4v",".mov"],maxFileSize:P,maxAllowedFiles:5,locationId:-1},Q=class extends Error{},ee=class extends Error{},eo=class extends Error{constructor(e,o){super(),eD(this,"uploaderProgressData",void 0),eD(this,"originalError",void 0),this.uploaderProgressData=e,this.originalError=o}},ed=u({photos:[],photosResultQueue:[],open:()=>{},dragging:!1,progress:null,selectFiles:()=>{},uploadFiles:()=>{},addPhotosUploadedCallback:()=>{},removePhotosUploadedCallback:()=>{}}),en={withMetadata:!0,isForCuration:!1,allowedFileTypes:[...et.allowedFileTypes,...el.allowedFileTypes],maxFileSize:P,locationId:-1},es=e$,ep=eB,eu=eW,ec=ej,em=eq,eh=eY,eI=h(()=>o("vdjnw8")),e({CustomPhotoUploadProvider:ek,D:eu,FileSizeError:K,FileTypeError:J,M:eh,PostPhotosUploader:eG,T:ec,VideoUploader:eH,a:et,b:em,d:el,u:ey,useCustomPhotoUpload:eZ,useMediaUploader:eK})},[e=>(a=e.jsx,r=e.jsxs,i=e.Fragment),e=>(t=e.useCallback,l=e.useState,d=e.useRef,n=e.useEffect,s=e.useContext,p=e.useMemo,u=e.createContext,c=e.Fragment,m=e.Suspense,h=e.lazy),e=>I=e.useVDOMPortal,e=>(g=e.default,v=e.useLocalize),e=>(_=e.Toast,f=e.ToastItem),e=>U=e.default,e=>T=e.useInteractionLogger,e=>A=e.ErrorBoundary,e=>(w=e.fileExtension,F=e.maxImageUploadSizeInBytes,P=e.maxVideoUploadSizeInBytes),e=>L=e.default,e=>(b=e.default,E=e.BorderlessButton,y=e.CircularButton),e=>N=e.useWindow,e=>O=e.useMutation,e=>x=e.uuid,e=>(S=e.useAddAttempt,D=e.WarPhotoCounter,C=e.useMarkAsSuccess,R=e.useMarkAsFailure,M=e.useMarkAsRateLimitedError,k=e.useMarkAsClientAborted,Z=e.useMarkAsClientError),e=>$=e.default,e=>z=e.default,e=>B=e.useKeyboardNavigationMode,e=>W=e.default,e=>j=e.margin,e=>q=e.default,e=>V=e.LocationSelector,e=>Y=e.default,e=>G=e.default,e=>H=e.TextArea]]},["21h32l","o4yt4q","4euaes","7thqz4","tr3542","rdycz1","32pwc7","83pm0d","714tj5","v5ce81","jppfwt","ltllz9","mqwhqn","eww825","27fomg","lchj5q","essqvy","2r4qug","fkji80","gw8uw6","lr6tb6","32kj4i","qkjm8h","qndsds","u3aiot"]]);
