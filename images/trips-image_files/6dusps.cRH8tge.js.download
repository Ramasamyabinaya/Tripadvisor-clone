(this.$WP=this.$WP||[]).push(["6dusps",(e,t)=>{var r,a,n,l,i,o,s,u,g,m,v,p,c,d,S,y,f,T,I,b,h,k,E,x,N,w,P,F,M,V,O,D,L,A,C,B,R,q=(e,t,r)=>{var a={...e.current};a[t]=[...new Set([...a[t]||[],r])],e.current=a},G=[],J=()=>{var e=E({experimentKeys:G,userId:y()||void 0,skipImpression:!0});return null===e?null:Object.keys(e).length>0},U=e=>{var{fetching:t,isEligible:r}=w("interstitial",{logImpression:!0});return t?null:r?"trip-text":(q(e,"tripText","notEligibleEntrypoint"),"")},_=()=>{var{page:e,params:t}=c(),r=t.discountCode||null,a="Plus"===e&&(!!t.autopop||""===t.autopop)&&!!r,n="Plus"===e&&null!==t.autopop&&"SUMMER0"===t.autopop;return a||n},j=({delayed:e,children:t})=>r(M.Provider,{value:e,children:t}),z="interstitialData",K=e=>e?new Map(JSON.parse(e)):new Map,$=(e,t,r)=>{var a=K(e).get(t),n=new Date().getTime();return a&&a?.find(e=>e.key===r&&(!e.ttl||e.ttl>=n))||null},W=(e,t,r,a)=>($(e,t,r)?.value||a)+0,X=(e,t,r,a)=>!!($(e,t,r)?.value??a),H=(e,t,r)=>{var a=e.get(t),n=new Date().getTime();return a=a?.filter(e=>e.key!==r.key&&(!e.ttl||e.ttl>=n))||[],r.ttl&&(r.ttl+=n),a.push(r),e.set(t,a),e},Q=(e,t,r,a)=>{var n=K(I.get(z)||"");H(n,e,{key:t,value:r,ttl:a}),I.set(z,JSON.stringify(Array.from(n.entries())))},Y=(e,t,r)=>{var a=K(b.get(z)||"");H(a,e,{key:t,value:r}),b.set(z,JSON.stringify(Array.from(a.entries())))},Z=/^https?:\/\/[a-z\-\.0-9]+\.tripadvisor(-preview)?\.[a-z\-\.]+/,ee=e=>{var[t,r]=n(e);return l(()=>{r(!Z.test(document.referrer))},[]),t},et="pageViews",er="delayPageViews",ea="sessionPreviouslySeenCounter",en="sessionPreviouslySeenGhost",el="previouslySeenInterval",ei="previouslySeenTotal",eo="previouslySeenIntervalGhost",es="previouslySeenTotalGhost",eu="IneligibilityLogged",eg="interstitialData",em=({children:e,onShow:t,onControlWouldShow:a,delaySeconds:u,delayPageViews:g,afterPageViews:m,maxSeen:v,maxSeenSession:S,campaignInfo:T,isDatePickerOpen:E,suppress:x,suppressWhenDelayed:N,ignoreInterval:w,onSkip:P,fallback:F=null,isControl:M=!1})=>{var{campaignName:C,variant:B}=T,[R,G]=n(!1),[J,U]=n(""),[_,j]=n("");l(()=>{G(!0),U(I.get(eg)),j(b.get(eg))},[]);var z=i(()=>O.getNumberFromStorage(J,C,et,0),[J,C]),K=i(()=>O.getNumberFromStorage(J,C,er,0),[J,C]),$=i(()=>O.getBooleanFromStorage(J,C,el,!1),[J,C]),W=i(()=>O.getNumberFromStorage(J,C,ei,0),[J,C]),X=i(()=>O.getNumberFromStorage(_,C,ea,0),[_,C]),H=i(()=>O.getBooleanFromStorage(J,C,eo,!1),[J,C]),Q=i(()=>O.getNumberFromStorage(J,C,es,0),[J,C]),Y=i(()=>O.getNumberFromStorage(_,C,en,0),[_,C]),Z=o({}),[ee,em]=n(!1),{funnelKey:ev}=s(f),{page:ep}=c(),ec=d(),ed=p(),eS=y(),ey=h(),ef=k();l(()=>{R&&(w||!$)&&O.saveValueToLocalStorage(C,et,z+1,A)},[C,z,$,w,R]);var eT=D.useIsExternalReferrer(!0),eI=!!eT&&K<g,eb=x||eI&&N;l(()=>{(eb||E)&&em(!1)},[eb,E]);var eh=i(()=>!E&&z>=m&&(w||!$)&&W<v&&X<S,[E,z,m,$,W,X,v,S,w]);return l(()=>{R&&(!eh||eb)&&P&&P()},[R,eh,eb,P]),l(()=>{if(!R)return()=>{};var e=()=>{(w||!H)&&Y<S&&Q<v&&eh&&!E&&(ey({optimusMarketingInterstitial:{name:M?`control_${B}`:B,pageviewUid:ec}}),M&&(a&&a(),O.saveValueToSessionStorage(C,en,Y+1),O.saveValueToLocalStorage(C,eo,!0,L),O.saveValueToLocalStorage(C,es,Q+1,A))),!eb&&eh&&!E&&(O.saveValueToSessionStorage(C,ea,X+1),O.saveValueToLocalStorage(C,el,!0,L),O.saveValueToLocalStorage(C,ei,W+1,A),em(!0),t&&t())},r=O.getBooleanFromStorage(J,C,eu,!1);if(eh){eI&&!N&&O.saveValueToLocalStorage(C,er,K+1,A);var n=()=>{document.querySelector('[title="regcontroller"]')||document.getElementById("explicitPreferences")||e()};if(!eI||N||M)n();else{var l=setTimeout(n,1e3*u);return()=>clearTimeout(l)}}else!r&&(z<m&&q(Z,"common","notEnoughPageViews"),$&&!w&&q(Z,"common","seenMaxInterval"),X>=S&&q(Z,"common","seenMaxSession"),W>=v&&q(Z,"common","seenMaxOverall"),Object.keys(Z.current).length>0&&(O.saveValueToLocalStorage(C,eu,!0,L),ef({externalKey:ev,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:ep,pageUid:ec,sessionId:ed,team:"Plus",userId:eS,customData:JSON.stringify({...Z.current})})));return()=>{}},[eh,eT,em,u,g,K,X,Y,W,Q,H,v,S,E,t,eb,ey,ec,B,M,w,ef,ev,ep,ed,eS,Z,z,m,$,C,J,eI,a,N,R]),r(V,{delayed:eI,children:ee?e:F})},ev=e=>{var t=P();return"preDatePicker"===e&&!t},ep=({variant:e,onInterstitialClose:t})=>{var a;if("trip-text"===e)a=e;else throw Error(`Education interstitial not implemented for variant ${e}`);return r(R,{variant:a,onClose:()=>t(),dataAutomationTag:"plusMarketingInterstitial"})},ec=({variant:e,onInterstitialClose:t})=>{var a=ep({variant:e,onInterstitialClose:t});return r(N,{children:r(u,{children:a})})},ed=e=>{var t=F(e);return null===t?null:t?{campaignName:"tripText",variant:t}:{campaignName:"",variant:""}},eS=({delaySeconds:e=30,afterPageViews:t=0,delayPageViews:a=1,maxSeen:i=3,maxSeenSession:u=1,isDatePickerOpen:g,onPopupDismiss:v,onOpen:T,onClose:I,fallback:b=null,popupOrder:h})=>{var E=o({}),[N,w]=n(null),{isOptimusEnabled:P,isOptimusSubscribed:F}=x(),{page:M}=c(),V=d(),O=ed(E),D=_(),L=J(),A=k(),{funnelKey:R}=s(f),G=p(),U=y(),j=S();l(()=>{null===N&&w(O)},[R,A,O,P,F,M,V,N,G,U]),l(()=>{null!==N&&(F&&q(E,"common","alreadySubscribed"),L&&Object.keys(E.current).length>0&&A({externalKey:R,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:M,pageUid:V,sessionId:G,team:"Plus",userId:U,customData:JSON.stringify({...E.current})}))},[R,A,L,"MOBILE"===j,F,M,V,N,G,U]);var z=m(()=>{I&&I(),v&&v()},[I,v]),K=null===N||null===L,$=(F||!N?.variant)&&!K;l(()=>{$&&v&&v()},[$,v]);var W=B(h);if(K)return null;if($)return b;var X=ec({variant:N.variant,onInterstitialClose:z}),H=i,Q=u;return D&&(H=Number.MAX_SAFE_INTEGER,Q=Number.MAX_SAFE_INTEGER),r(C,{delaySeconds:e,delayPageViews:D?0:a,afterPageViews:t,maxSeen:H,maxSeenSession:Q,campaignInfo:N,isDatePickerOpen:g,onSkip:v,ignoreInterval:D,onShow:T,fallback:b,suppressWhenDelayed:W,children:X})},ey=e=>{var[t]=n(v());return r(T,{funnelKey:t,children:r(eS,{...e})})};return[()=>{F=U,M=a(!1),V=j,O={getNumberFromStorage:W,getBooleanFromStorage:X,saveValueToLocalStorage:Q,saveValueToSessionStorage:Y},D={useIsExternalReferrer:ee},A=14*(L=864e5),C=em,B=ev,R=g(()=>t("kfvtb3")),e("default",ey)},[e=>r=e.jsx,e=>(a=e.createContext,n=e.useState,l=e.useEffect,i=e.useMemo,o=e.useRef,s=e.useContext,u=e.Suspense,g=e.lazy,m=e.useCallback),e=>v=e.uuid,e=>p=e.useSessionId,e=>(c=e.useRoute,d=e.usePageviewUid),e=>S=e.useViewportCategory,e=>y=e.useUserId,e=>(f=e.FunnelTracking,T=e.FunnelTrackingProvider),e=>I=e.default,e=>b=e.default,e=>h=e.useImpressionLogger,e=>k=e.default,e=>E=e.default,e=>x=e.useOptimusEnabledForUser,e=>N=e.ErrorBoundary,e=>w=e.useIsEntrypointEligibleForTextDemandTest,e=>P=e.useIsDated]]},["21h32l","o4yt4q","eww825","al4vil","fgwvq1","ys6v1o","52far5","kkqcv8","9b9b10","tp1g68","vumu0s","xg719z","gugp1d","4tv4as","83pm0d","notq9u","2tnrli"]]);
