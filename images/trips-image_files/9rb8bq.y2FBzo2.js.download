(this.$WP=this.$WP||[]).push(["9rb8bq",(e,t)=>{var r,i,a,n,o,s,d,l,p,c,u,v,T,m,C,I,S,f,E,b,h,y,g,k,_,A,R,O,L,M,w,N,D,P,V,j,x,q,F,z,U,G,W,B,X,Q,$,Y,H,K={__key:0xce070fe462b1,id:"ce070fe462b1e585",loc:{},definitions:[]},Z=(e,t)=>{if(!t)return e;var r=e.paginatedTrips?.trips||[],i=t.paginatedTrips?.trips||[];return{paginatedTrips:e.paginatedTrips?{trips:[...r,...i],hasMore:!!t.paginatedTrips?.hasMore,__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},J=e=>({__typename:"Trip",id:e.id||0,title:e.title||void 0,status:e.status?.toUpperCase()||void 0,photoId:e.photo&&"id"in e.photo?e.photo.id:void 0,photo:e.photo||{},date:e.date?{from:e.date.from??void 0,to:e.date.to??void 0,type:e.date.type??void 0,duration:e.date.duration??0}:void 0,route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!!e.actionPermissions?.canAddItem},tripLocations:e.tripLocations||[]}),ee=e=>{var t=(t,r)=>{if(!t||!r)return"invalidateAndRefetch";var{originalObject:i}=e;return i&&r===i.type&&t===String(i.id)||r===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},r=R(),i=E(e),[a,n]=F({query:K,variables:{offset:0,limit:10,userId:r||"",referenceId:i.id,referenceType:i.type,loadSavedTrips:!0},combineData:Z,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:r}})=>t(e,r),Trips_addItemReferences:({variables:{request:e}})=>t(e?.references?.[0]?.id,e?.references?.[0]?.type),Trips_moveTripItems:({variables:{reference:e}})=>t(e?.id,e?.type),tripsRemoveItem:({variables:{reference:e}})=>t(e?.id,e?.type),tripsRemoveReference:({variables:{reference:e}})=>t(e?.id,e?.type),Trips_copyTripItem:({variables:{reference:e}})=>t(e?.id,e?.type)}}),o=a.data?.paginatedTrips?.trips||[],s=o.slice().filter(Boolean).map(J),d=!!a.data?.paginatedTrips?.hasMore,l=a.data?.savedTrips||[],p=new Set(l.map(e=>e?.id).filter(Boolean)),c=d||a.error?()=>n({offset:o?.length||0,loadSavedTrips:!1},a.error?{requestPolicy:"network-only"}:void 0):()=>Promise.resolve();return{fetching:a.fetching,error:!!a.error,data:{tripList:s,saveSet:p},hasMore:d,loadMore:c}},et={DEFAULT:e=>"bundleSave"!==e?r(D,{id:"stat_modal_save_to_trip_v2"}):r(D,{id:"save_all_items_modal_header"}),CREATE:()=>r(D,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>r(D,{id:"select_trip_header"}),SELECT_CREATE:()=>r(D,{id:"stat_modal_create_a_trip_v2"})},er=({saveObject:e,initialTripTitle:t,overlayState:o,validateTripName:s,lastSavedItem:d,trackingContext:l,trackingSource:p,sourceTripId:c,tripItemId:T,additionalItemReferences:m,showPlacesToStay:I,sponsorship:S,isPublicTripAndViewerRole:f,...E})=>{var h,y=u(),{isTripsV2:g}=A(),k=v(T,S),_=x(()=>{g&&(y({itemName:"SaveTripModal",locationId:"location"===e.type?Number(e.id):void 0}),f&&k({itemName:"PublicTripSaveItems"}))}),[R,O]=i(!0),{fetching:L,error:D,data:F,hasMore:z,loadMore:Q}=U(e);L?h=r(N,{size:"large"}):D&&(h=r(P,{refetch:Q}));var $="gaiTrip"===e.type,Y="publicTripBundle"===e.type,H=$?"COPY":"SAVE";a(()=>{L||O(!1)},[L]);var[K]=C({source:p||"trips",trackingContext:l,pageAsContext:!0,withSaveSession:!0}),Z=()=>{E.onClose(),O(!0)},J=et[o](e.type),ee=e=>r(w,{widthOption:"fixed-40",heightOption:"restricted",roundCorners:!0,title:J,stickyFooter:!1,onClose:Z,children:r("div",{className:"tvfpI",children:e})}),er=ee(r(N,{size:"large"})),ei=()=>ee(r(j,{variant:"retry"})),ea=e=>{e.target===e.currentTarget&&Z()},en="bundleSave"===e.type?"copyTripModal":"saveTripModal";return r(q,{element:g?en:void 0,children:r(M,{className:"MmndE D t _U s l Za f",onClose:Z,onMouseDown:ea,onTouchStart:ea,onClick:e=>{e.stopPropagation()},ref:_,children:r("div",{className:"tubFl f _Y e",children:h&&R?ee(h):(()=>{var i=d?b(d):void 0,a=()=>$||Y?r(V,{errorRenderer:ei,children:r(n,{fallback:er,children:r(B,{title:J,onClose:Z,onCreateTripInputChange:E.onCreateTripInputChange,sourceTripId:Number(e.id),isGaiTrip:$,additionalItemReferences:m,initialTripTitle:t,onMount:()=>{L||D||K({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{E.statCallback("ADD","NEW",e,!0,!0),Z()},validateTripName:s,trackingContext:l,trackingSource:p,showPlacesToStay:I})})}):r(V,{errorRenderer:ei,children:r(n,{fallback:er,children:r(G,{title:J,onClose:Z,object:e,onMount:()=>{L||D||K({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{E.statCallback("ADD","NEW",e,!0,!0),Z()},onError:E.onError,validateTripName:s,trackingContext:l,trackingSource:p,sourceTripId:c,tripItemId:T,additionalItemReferences:m})})});switch(o){case"DEFAULT":return 0===F.tripList.length?a():r(V,{errorRenderer:ei,children:r(n,{fallback:er,children:r(X,{title:J,onClose:Z,tripList:F.tripList,savedSet:F.saveSet,tripListBottom:h,onPaginate:Q,hasMore:z,saveObject:e,onMount:()=>{E.preventInteractionInMountedComponents||K({elementClick:{element:"stat"}})},onCreateTrip:()=>{E.onCreateTripClicked&&E.onCreateTripClicked()},tripAction:H,onRemovedFromTrip:(e,t,r)=>{E.statCallback("REMOVE","EXISTING",e,t,r),Z()},onSavedToTrip:(e,t,r)=>{E.statCallback("ADD","EXISTING",e,t,r),Z()},onSaveToTripClick:(e,t,r)=>{E.statCallback("CLICK","EXISTING",e,t,r)},onError:E.onError,trackingContext:l,trackingSource:p,sourceTripId:c,tripItemId:T,additionalItemReferences:m})})});case"CREATE":return a();case"SELECT":if(i)return r(V,{errorRenderer:ei,children:r(n,{fallback:er,children:r(X,{title:J,onClose:Z,tripList:F.tripList,savedSet:F.saveSet,tripListBottom:h,onPaginate:Q,hasMore:z,saveObject:i,onMount:()=>{K({elementClick:{element:"stat"}})},onCreateTrip:()=>{E.onSelectCreateTripClicked&&E.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,r)=>{E.statCallback("MOVE","EXISTING",e,t,r),Z()},onRemovedFromTrip:(e,t,r)=>{E.statCallback("REMOVE","EXISTING",e,t,r),Z()},onError:E.onError,trackingContext:l,trackingSource:p,sourceTripId:c,tripItemId:T,additionalItemReferences:m})})});return"";case"SELECT_CREATE":if(d)return r(V,{errorRenderer:ei,children:r(n,{fallback:er,children:r(W,{title:J,onClose:Z,item:d,onMovedToCreatedTrip:e=>{E.statCallback("MOVE","NEW",e,!0,!0),Z()},object:e})})});return a();default:return""}})()})})})},ei=e=>{},ea=(e,t)=>{switch(t.type){case"setOverlayState":return{...e,overlayState:t.state??e.overlayState};case"afterSave":return{...e,overlayState:"DEFAULT",preventInteractionInMountedComponents:!0};default:throw Error()}},en=({allowPopStatModal:e,logInteraction:t,puid:a,object:n,active:o,initialTripTitle:p,preventInteractionPropagation:c,trackingContext:u,trackingSource:v,resaveTrip:T,saveObject:m,saveStatus:C,updateLastTripId:I,onClose:f=()=>{},initialOverlayState:E,onViewTripToastVisible:b,viewTripOpensNewTab:y,tripItemId:g,sourceTripId:k,additionalItemReferences:_,showPlacesToStay:A,sponsorship:L,isPublicTripAndViewerRole:M,...w})=>{var N=R(),{launchViewTripToast:D,launchRemoveFromTripToast:P,launchErrorTripToast:V}=h(),{getTripErrorMessage:j}=O(),x=s(S),[q,F]=d(ea,{overlayState:E||"DEFAULT",preventInteractionInMountedComponents:!1}),{onComplete:z}=w,U=l((e,t,r,i,a)=>{z&&z(e,t,r,i,a),x.resetSession()},[z,x]),G=l((e,r)=>{e&&!r?(D({trip:e,messageType:"SAVED",onCtaClick:()=>{t({elementClick:{element:"saved_viewTrip"}})}}),U(!0,"SAVED")):r&&(V(r),U(!1)),F({type:"setOverlayState",state:"DEFAULT"}),t({elementClick:{element:"unsave_undo"}})},[D,U,V,t]),W=l(e=>{P(e,m,G)},[P,G,m]),B=l(e=>{V(e)},[V]),[X,$]=i(!1),Y=l(()=>{$(!0),x.resetSession(),f()},[x,f]),H=l((e,r,i)=>{F({type:"afterSave"}),D({trip:e,messageType:r,onCtaClick:()=>{t({elementClick:{element:"saved_viewTrip"}})},onVisible:()=>b?.(r,e.id),openTripInNewTab:y}),I(e.id),U(!0,r,e.id,e.title,i)},[D,I,U,t,b,y]);return X?null:r("div",{role:"presentation",className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!c&&N&&t({elementClick:{element:"item_save",tripId:T?.id}})},children:r(Q,{onCreateTripInputChange:w.onCreateTripInputChange,saveObject:m,additionalItemReferences:_,initialTripTitle:p,overlayState:q.overlayState,lastSavedItem:C.result?.tripItem,trackingContext:u,trackingSource:v,onCreateTripClicked:()=>{F({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{F({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:Y,onError:B,preventInteractionInMountedComponents:q.preventInteractionInMountedComponents,statCallback:(e,t,r,i,a=!1)=>{r&&"id"in r&&("REMOVE"===e?(W(r),U(a)):"NEW"===t?H(r,"CREATED",Number(m.id)):"CLICK"===e&&"EXISTING"===t?w?.onItemClick?.(r.id,r.title):i&&H(r,"SAVED",Number(m.id)))},validateTripName:e=>{if("bundleSave"===m.type&&e.trim().toLowerCase()===n?.title?.trim().toLowerCase())return j("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})},tripItemId:g,sourceTripId:k,showPlacesToStay:A,sponsorship:L,isPublicTripAndViewerRole:M})})},eo=e=>r(I,{children:r(L,{children:r(en,{...e})})}),es=["Profile","HomeFeed","Trips","Home"],ed=e=>{var t=y(),{isTripsV2:i}=A(),n=p(()=>e.saveObject||b(e.object,!0),[e.saveObject,e.object]),{resaveTrip:o,onComplete:d,allowPopStatModal:v,flowOrigin:I,onAutosavedToTripToastVisible:E}=e,{isNativeWebview:R,tripId:O,tripItemId:L,sourceTripId:M,...w}=e,{launchAutoSavedToTripToast:N,launchErrorTripToast:D}=h({saveToast:e.saveToast}),[P,V]=C(p(()=>({source:e.trackingSource||"trips",saveObject:n,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0}),[e.trackingContext,e.trackingSource,n])),j=T(),x=u(),q=s(S),[F,z,U]=g({selectedTripId:O,object:n,isActive:e.active,tripItemId:L,sourceTripId:M}),G=n?.id,W=n?.type,{page:B}=t,X=l(e=>{D(e)},[D]),Q=l(()=>{i?x({itemName:"SignInModal"}):P({elementClick:{element:"ITEM_SAVE_LOGIN",context:B?f(B):void 0,puid:V,saveType:W,detailId:G?`${G}`:"",tripId:o?.id,sessionType:"SAVE",sessionUuid:q.sessionUuid,sessionOrder:q.sessionOrder}})},[P,B,V,o,G,W,q.sessionOrder,q.sessionUuid,i,x]),Y=l(({hasCreatedMember:e,userId:t})=>{sessionStorage.setItem("DELEGATE_RELOAD","true"),i?x({itemName:"SuccessfulSignUp",customData:{isNewMember:!!e,userId:t}}):P({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:B&&f(B)||void 0,puid:V,saveType:W,detailId:G?`${G}`:"",tripId:o?.id,sessionType:"SAVE",sessionUuid:q.sessionUuid,sessionOrder:q.sessionOrder}})},[P,B,V,o,G,W,q.sessionOrder,q.sessionUuid,i,x]),H=k(p(()=>({pid:B&&es.includes(t.page)?40439:39766,flow:R?"NATIVE_LOGIN":"SAVES_COMBINED",flowOrigin:I,flowId:"122",onLogin:Q,onSuccess:Y,isFullWidthMobile:!0}),[Q,Y,B,t.page,R,I])),K=c(!1),{open:Z}=_(()=>n?r(m,{providerValues:j,children:r($,{...w,logInteraction:P,puid:V,initialTripTitle:e.initialTripTitle,saveObject:n,saveStatus:F,updateLastTripId:U,viewTripOpensNewTab:e.viewTripOpensNewTab,sourceTripId:M,tripItemId:L,additionalItemReferences:e.additionalItemReferences,onClose:()=>{sessionStorage.getItem("DELEGATE_RELOAD")&&(sessionStorage.removeItem("DELEGATE_RELOAD"),window.location.reload())}})}):null,void 0,[j]),{open:J}=_(()=>n?r(m,{providerValues:j,children:r($,{...w,initialOverlayState:"SELECT",logInteraction:P,puid:V,saveObject:n,saveStatus:F,updateLastTripId:U,viewTripOpensNewTab:e.viewTripOpensNewTab,sourceTripId:M,tripItemId:L,additionalItemReferences:e.additionalItemReferences})}):null,void 0,[j]),ee=!!v&&"popStat"in t.params&&t.params.popStat;return a(()=>{ee&&!K.current&&(K.current=!0,P({elementClick:{element:"autoPopStat"}}),H().then(Z))},[P,H,Z,ee]),l(()=>{H().then(()=>z()).then(([e,t])=>{if(null===e&&null===t){Z();return}t?X({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(N(e,()=>{J(),P({elementClick:{element:"quickSave_change"}})},()=>E?.("SAVED",e.id)),P({modalSuccess:{element:"quickSave",tripId:o?.id,context:B&&f(B)||void 0,saveType:W,detailId:G?`${G}`:""}}),d&&d(!0,void 0,e.id,e.title,Number(G)))})},[Z,J,E,N,P,H,d,X,z,B,o,G,W])},el=({children:e,...t})=>{var i=p(()=>t.saveObject||b(t.object,!0),[t.saveObject,t.object]),a=Y(t);return i?r(I,{children:e(a)}):null},ep=({children:e,skipCreateTripTracking:t,signedInPrior:i,flowId:a,...n})=>r(m,{providerValues:{skipCreateTripTracking:t,signedInPrior:i,flowId:a},children:r(el,{...n,children:e})}),ec={__key:41755096501858,id:"25f9ddb1ce629144",loc:{},definitions:[]},eu=({queryObject:e,object:t,children:i,...a})=>{function n(t,r){if(!t||!r)return"invalidateAndRefetch";var{originalObject:i}=e;return i&&r===i.type&&t===String(i.id)||r===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"}var o=R(),[{fetching:s,data:d}]=z({query:ec,variables:{request:{id:String(e.id),type:e.type}},pause:!o},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>n(e,t),Trips_addItemReferences:({variables:{request:e}})=>n(e?.references?.[0]?.id,e?.references?.[0]?.type),tripsRemoveItem:({variables:{reference:e}})=>n(e?.id,e?.type),tripsRemoveReference:({variables:{reference:e}})=>n(e.id,e?.type),Trips_copyTrip:({variables:{reference:e}})=>n(e?.id,e?.type),Trips_cloneTrip:({variables:{reference:e}})=>n(e?.id,e?.type),Trips_copyTripItem:({variables:{reference:e}})=>n(e?.id,e?.type),Trips_removeItemReferences:({variables:{reference:e}})=>n(e?.id,e?.type)}),l=!1;return"boolean"==typeof d?.isSaved?.[0]&&(l=!!d.isSaved[0]),r(H,{active:l,object:t,...a,children:e=>i(e,l,s)})},ev=e=>{var t=e.saveObject||b(e.object,!0);return t?r(eu,{...e,queryObject:t}):(console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{U=ee,G=o(()=>t("5kzfzt").then(e=>({default:e.CreateTripWithAddItemModal}))),W=o(()=>t("5kzfzt").then(e=>({default:e.CreateTripWithMoveItemModal}))),B=o(()=>t("5kzfzt").then(e=>({default:e.CloneTripModal}))),X=o(()=>t("an5ymg").then(e=>({default:e.SaveToTripContent}))),Q=er,en.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},$=eo,Y=ed,H=ep,ev.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:ev,TripFlowSelector:H,setSTATDisabledForTesting:ei})},[e=>r=e.jsx,e=>(i=e.useState,a=e.useEffect,n=e.Suspense,o=e.lazy,s=e.useContext,d=e.useReducer,l=e.useCallback,p=e.useMemo,c=e.useRef),e=>(u=e.useCreateTripImpressionLogger,v=e.usePublicInteractionLogger,T=e.useCreateTripTrackingContext,m=e.CreateTripTrackingProvider),e=>(C=e.useTripInteraction,I=e.SaveSessionProvider,S=e.SaveSessionTrackingContext,f=e.getInteractionsContext),e=>(E=e.toReference,b=e.toSavesObject),e=>h=e.default,e=>y=e.useRoute,e=>g=e.useAutosave,e=>k=e.useSocialLoginGate,e=>_=e.useVDOMPortal,e=>A=e.useTripsVersion,e=>R=e.useUserId,e=>O=e.useLocalizeTripError,e=>L=e.ToastProvider,e=>M=e.ModalBase,e=>w=e.ContentContainer,e=>N=e.LoadingSpinner,e=>D=e.default,e=>P=e.default,e=>V=e.ErrorBoundary,e=>j=e.default,e=>x=e.useOnVisible,e=>q=e.TripsImpression,e=>(F=e.usePaginatedQuery,z=e.useInvalidatableQuery)]]},["21h32l","o4yt4q","sa2a6q","k7dpqn","iyqcwg","2wscmt","fgwvq1","uw9rn6","0506zk","4euaes","juddza","52far5","mc5s4b","tr3542","uzmmz7","i3sz5h","l9qeu7","7thqz4","qhcore","83pm0d","tm42hr","3btuy0","665v5s","fbuhsy"]]);
